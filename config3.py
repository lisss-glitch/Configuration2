import os  # –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
import collections  # –º–æ–¥—É–ª—å –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö


class DependencyGraph:
    """–ö–ª–∞—Å—Å –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""

    def __init__(self):
        self.graph = collections.defaultdict(list)  # –≥—Ä–∞—Ñ: –ø–∞–∫–µ—Ç -> —Å–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        self.cycles = []  # —Å–ø–∏—Å–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        self.all_packages = set()  # –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

    def build_from_file(self, file_path):
        """–°—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ –∏–∑ —Ñ–∞–π–ª–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""
        if not os.path.exists(file_path):  # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
            print(f"–û—à–∏–±–∫–∞: –§–∞–π–ª '{file_path}' –Ω–µ –Ω–∞–π–¥–µ–Ω!")
            return False

        print(f"–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∞–π–ª {file_path}...")

        try:
            with open(file_path, 'r', encoding='utf-8') as file:  # –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞
                for line_num, line in enumerate(file, 1):  # —á—Ç–µ–Ω–∏–µ —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π —Å—Ç—Ä–æ–∫
                    line = line.strip()  # —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤
                    if not line or line.startswith('#'):  # –ø—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                        continue

                    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: A: B, C –∏–ª–∏ A -> B, C
                    if ':' in line:  # —Ñ–æ—Ä–º–∞—Ç —Å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º
                        parts = line.split(':', 1)  # —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–µ—Ä–≤–æ–º—É –¥–≤–æ–µ—Ç–æ—á–∏—é
                    elif '->' in line:  # —Ñ–æ—Ä–º–∞—Ç —Å–æ —Å—Ç—Ä–µ–ª–∫–æ–π
                        parts = line.split('->', 1)  # —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–µ–ª–∫–µ
                    else:  # –µ—Å–ª–∏ –Ω–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è
                        package = line.strip()  # –ø–æ–ª—É—á–∞–µ–º –∏–º—è –ø–∞–∫–µ—Ç–∞
                        if package and self._is_valid_package_name(package):  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
                            self.graph[package] = []  # –¥–æ–±–∞–≤–ª—è–µ–º –ø–∞–∫–µ—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
                            self.all_packages.add(package)  # –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ
                        continue  # –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ

                    if len(parts) != 2:  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
                        print(f"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ —Å—Ç—Ä–æ–∫–µ {line_num}: {line}")
                        continue

                    package = parts[0].strip()  # –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–∞–∫–µ—Ç–∞
                    deps_str = parts[1].strip()  # –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ –ø–∞–∫–µ—Ç–∞
                    if not self._is_valid_package_name(package):  # –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏
                        print(f"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–∞–∫–µ—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–µ {line_num}: {package}")
                        continue

                    self.all_packages.add(package)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ

                    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
                    dep_list = []  # —Å–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
                    if deps_str:  # –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
                        # –£–±–∏—Ä–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
                        if deps_str.startswith('[') and deps_str.endswith(']'):  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∫–æ–±–∫–∏
                            deps_str = deps_str[1:-1]  # —É–¥–∞–ª–µ–Ω–∏–µ —Å–∫–æ–±–æ–∫

                        for dep in deps_str.split(','):  # —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–∞–ø—è—Ç—ã–º
                            dep = dep.strip()  # –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤
                            if dep and self._is_valid_package_name(dep):  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
                                dep_list.append(dep)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
                                self.all_packages.add(dep)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤

                    self.graph[package] = dep_list  # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø–∞–∫–µ—Ç–∞

            # –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –≥—Ä–∞—Ñ
            for package in self.all_packages:  # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–µ
                if package not in self.graph:  # –µ—Å–ª–∏ –ø–∞–∫–µ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä–∞—Ñ
                    self.graph[package] = []  # –¥–æ–±–∞–≤–ª—è–µ–º —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

            return True  # —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

        except Exception as e:  # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {e}")
            return False  # –Ω–µ—É–¥–∞—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

    def _is_valid_package_name(self, name):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∏–º—è –ø–∞–∫–µ—Ç–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö –±—É–∫–≤"""
        return name.isalpha() and name.isupper()  # —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã

    def dfs_traversal(self, start_package, max_depth, current_depth=0, visited=None, path=None):
        """–û–±—Ö–æ–¥ –≥—Ä–∞—Ñ–∞ –≤ –≥–ª—É–±–∏–Ω—É —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ –≥–ª—É–±–∏–Ω–µ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º —Ü–∏–∫–ª–æ–≤"""
        if visited is None:  # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ—Å–µ—â–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤
            visited = set()
        if path is None:  # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø—É—Ç–∏
            path = []

        if current_depth > max_depth:  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã
            return []  # –≤–æ–∑–≤—Ä–∞—Ç –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–∏–∫–ª
        if start_package in path:  # –µ—Å–ª–∏ –ø–∞–∫–µ—Ç —É–∂–µ –≤ –ø—É—Ç–∏ (–æ–±–Ω–∞—Ä—É–∂–µ–Ω —Ü–∏–∫–ª)
            cycle = path[path.index(start_package):] + [start_package]  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–∞
            cycle_str = " -> ".join(cycle)  # –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É
            if cycle_str not in self.cycles:  # –µ—Å–ª–∏ —Ü–∏–∫–ª –Ω–æ–≤—ã–π
                self.cycles.append(cycle_str)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ —Ü–∏–∫–ª–æ–≤
            return []  # –≤–æ–∑–≤—Ä–∞—Ç –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞

        if start_package in visited:  # –µ—Å–ª–∏ –ø–∞–∫–µ—Ç —É–∂–µ –ø–æ—Å–µ—â–µ–Ω
            return []  # –≤–æ–∑–≤—Ä–∞—Ç –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞

        visited.add(start_package)  # –æ—Ç–º–µ—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞ –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω–æ–≥–æ
        path.append(start_package)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –≤ —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å

        result = [start_package]  # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

        # –†–ï–ö–£–†–°–ò–í–ù–´–ô DFS –í–´–ó–û–í
        for neighbor in self.graph.get(start_package, []):  # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å–µ–¥–∞
            result.extend(self.dfs_traversal(  # —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ DFS
                neighbor, max_depth, current_depth + 1, visited, path.copy()  # –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            ))

        path.pop()  # —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –∏–∑ –ø—É—Ç–∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ
        return result  # –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–±—Ö–æ–¥–∞

    def find_all_cycles(self):
        """–ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ü–∏–∫–ª—ã –≤ –≥—Ä–∞—Ñ–µ"""
        self.cycles = []  # –æ—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ —Ü–∏–∫–ª–æ–≤
        for node in self.graph.keys():  # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –≤ –≥—Ä–∞—Ñ–µ
            self._dfs_cycles(node, [], set())  # –ø–æ–∏—Å–∫ —Ü–∏–∫–ª–æ–≤ –∏–∑ —ç—Ç–æ–≥–æ —É–∑–ª–∞
        return self.cycles  # –≤–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ —Ü–∏–∫–ª–æ–≤

    def _dfs_cycles(self, node, path, visited):
        """–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ü–∏–∫–ª–æ–≤"""
        if node in path:  # –µ—Å–ª–∏ —É–∑–µ–ª —É–∂–µ –≤ –ø—É—Ç–∏ (–æ–±–Ω–∞—Ä—É–∂–µ–Ω —Ü–∏–∫–ª)
            cycle_start = path.index(node)  # –Ω–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞
            cycle = path[cycle_start:] + [node]  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–∞
            cycle_str = " -> ".join(cycle)  # –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É
            if cycle_str not in self.cycles:  # –µ—Å–ª–∏ —Ü–∏–∫–ª –Ω–æ–≤—ã–π
                self.cycles.append(cycle_str)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫
            return  # –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

        path.append(node)  # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞ –≤ –ø—É—Ç—å
        visited.add(node)  # –æ—Ç–º–µ—Ç–∫–∞ —É–∑–ª–∞ –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω–æ–≥–æ

        for neighbor in self.graph.get(node, []):  # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å–µ–¥–∞
            self._dfs_cycles(neighbor, path.copy(), visited)  # —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ü–∏–∫–ª–æ–≤

    def print_analysis(self, max_depth=3):
        """–í—ã–≤–æ–¥–∏—Ç –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∞"""
        print("\n" + "=" * 50)  # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        print("–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê –ì–†–ê–§–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
        print("=" * 50)

        # –í—ã–≤–æ–¥–∏–º –≥—Ä–∞—Ñ
        print("\n---")  # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        print("–ü–û–õ–ù–´–ô –ì–†–ê–§ –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô")  # –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
        print("---")
        for package in sorted(self.graph.keys()):  # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
            deps = self.graph[package]  # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
            print(f"{package} -> {deps}")  # –≤—ã–≤–æ–¥ –ø–∞–∫–µ—Ç–∞ –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

        print(f"\n–í—Å–µ–≥–æ –ø–∞–∫–µ—Ç–æ–≤ –≤ –≥—Ä–∞—Ñ–µ: {len(self.all_packages)}")  # —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        print("\n---")  # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        print("–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ì–†–ê–§–ê")  # –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
        print("---")
        print(f"–ù–∞–π–¥–µ–Ω–æ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ: {len(self.all_packages)}")  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤
        print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–∞–∫–µ—Ç–æ–≤: {len(self.graph)}")  # –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

        total_deps = sum(len(deps) for deps in self.graph.values())  # –ø–æ–¥—Å—á–µ—Ç –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        print(f"–í—Å–µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: {total_deps}")  # –≤—ã–≤–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

        # –ü–æ–∏—Å–∫ —Ü–∏–∫–ª–æ–≤
        self.find_all_cycles()  # –ø–æ–∏—Å–∫ –≤—Å–µ—Ö —Ü–∏–∫–ª–æ–≤
        if self.cycles:  # –µ—Å–ª–∏ —Ü–∏–∫–ª—ã –Ω–∞–π–¥–µ–Ω—ã
            print(f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ü–∏–∫–ª–æ–≤: {len(self.cycles)}")  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤
            print("\n–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã:")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
            for i, cycle in enumerate(self.cycles, 1):  # –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ü–∏–∫–ª–æ–≤
                print(f"  {i}. {cycle}")  # –≤—ã–≤–æ–¥ —Ü–∏–∫–ª–∞
        else:  # –µ—Å–ª–∏ —Ü–∏–∫–ª–æ–≤ –Ω–µ—Ç
            print("–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã")  # —Å–æ–æ–±—â–µ–Ω–∏–µ

        # DFS –æ–±—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
        print(f"\n---")  # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        print(f"DFS –û–ë–•–û–î –î–õ–Ø –í–°–ï–• –ü–ê–ö–ï–¢–û–í (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞: {max_depth})")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
        print(f"---")

        for package in sorted(self.graph.keys()):  # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞
            # –í–´–ó–û–í DFS –ê–õ–ì–û–†–ò–¢–ú–ê –ò –í–´–í–û–î –†–ï–ó–£–õ–¨–¢–ê–¢–ê
            traversal_result = self.dfs_traversal(package, max_depth)  # –æ–±—Ö–æ–¥ –≤ –≥–ª—É–±–∏–Ω—É
            print(f"{package}: {traversal_result}")  # –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–±—Ö–æ–¥–∞


def interactive_mode():
    """–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã"""
    print("–ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú –ê–ù–ê–õ–ò–ó–ê –ì–†–ê–§–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
    print("=" * 50)

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É
    while True:  # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏
        file_path = input("\n–í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–∞–∫–µ—Ç–æ–≤: ").strip()  # –≤–≤–æ–¥ –ø—É—Ç–∏
        if os.path.exists(file_path):  # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
            break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
        else:  # –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            print("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã
    while True:  # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã
        depth_input = input("üìè –í–≤–µ–¥–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É –∞–Ω–∞–ª–∏–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3): ").strip()  # –≤–≤–æ–¥ –≥–ª—É–±–∏–Ω—ã
        if not depth_input:  # –µ—Å–ª–∏ –≤–≤–æ–¥ –ø—É—Å—Ç–æ–π
            max_depth = 3  # –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
        try:  # –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
            max_depth = int(depth_input)  # –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Å–ª–æ
            if max_depth > 0:  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
            else:  # –µ—Å–ª–∏ –≥–ª—É–±–∏–Ω–∞ –Ω–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è
                print("–ì–ª—É–±–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        except ValueError:  # –µ—Å–ª–∏ –≤–≤–æ–¥ –Ω–µ —á–∏—Å–ª–æ
            print("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

    # –°—Ç—Ä–æ–∏–º –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ
    print("\n–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...")  # —Å–æ–æ–±—â–µ–Ω–∏–µ
    graph = DependencyGraph()  # —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≥—Ä–∞—Ñ–∞

    if graph.build_from_file(file_path):  # –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∏–∑ —Ñ–∞–π–ª–∞
        print("–ì—Ä–∞—Ñ —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        graph.print_analysis(max_depth)  # –≤—ã–≤–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
    else:  # –µ—Å–ª–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å
        print("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–∞!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ


def file_selection_mode():
    """–†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö"""
    print("–†–ï–ñ–ò–ú –í–´–ë–û–†–ê –§–ê–ô–õ–ê")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
    print("=" * 50)

    # –ò—â–µ–º –≤—Å–µ txt —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    available_files = [f for f in os.listdir('.') if f.endswith('.txt') and os.path.isfile(f)]  # –ø–æ–∏—Å–∫ txt —Ñ–∞–π–ª–æ–≤

    if not available_files:  # –µ—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
        print("–í —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ txt —Ñ–∞–π–ª–æ–≤!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ
        return  # –≤—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏

    print("\n–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã:")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
    for i, file in enumerate(available_files, 1):  # –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
        print(f"  {i}. {file}")  # –≤—ã–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ –∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
    while True:  # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
        try:  # –ø–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞
            choice = input(f"\n–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª (1-{len(available_files)}): ").strip()  # –≤–≤–æ–¥ –≤—ã–±–æ—Ä–∞
            if not choice:  # –µ—Å–ª–∏ –≤–≤–æ–¥ –ø—É—Å—Ç–æ–π
                continue  # –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–∞
            choice_num = int(choice)  # –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Å–ª–æ
            if 1 <= choice_num <= len(available_files):  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                selected_file = available_files[choice_num - 1]  # –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
                break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
            else:  # –µ—Å–ª–∏ —á–∏—Å–ª–æ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                print(f"–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ {len(available_files)}!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        except ValueError:  # –µ—Å–ª–∏ –≤–≤–æ–¥ –Ω–µ —á–∏—Å–ª–æ
            print("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥ –≥–ª—É–±–∏–Ω—ã
    while True:  # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã
        depth_input = input("–í–≤–µ–¥–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É –∞–Ω–∞–ª–∏–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3): ").strip()  # –≤–≤–æ–¥ –≥–ª—É–±–∏–Ω—ã
        if not depth_input:  # –µ—Å–ª–∏ –≤–≤–æ–¥ –ø—É—Å—Ç–æ–π
            max_depth = 3  # –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
        try:  # –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
            max_depth = int(depth_input)  # –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Å–ª–æ
            if max_depth > 0:  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
            else:  # –µ—Å–ª–∏ –≥–ª—É–±–∏–Ω–∞ –Ω–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è
                print("–ì–ª—É–±–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        except ValueError:  # –µ—Å–ª–∏ –≤–≤–æ–¥ –Ω–µ —á–∏—Å–ª–æ
            print("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

    # –°—Ç—Ä–æ–∏–º –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ
    print(f"\n–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∞–π–ª {selected_file}...")  # —Å–æ–æ–±—â–µ–Ω–∏–µ
    graph = DependencyGraph()  # —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≥—Ä–∞—Ñ–∞

    if graph.build_from_file(selected_file):  # –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∏–∑ —Ñ–∞–π–ª–∞
        print("–ì—Ä–∞—Ñ —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        graph.print_analysis(max_depth)  # –≤—ã–≤–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
    else:  # –µ—Å–ª–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å
        print("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–∞!")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    print("=" * 60)  # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    print("           –ê–ù–ê–õ–ò–ó–ê–¢–û–† –ì–†–ê–§–û–í –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô")  # –∑–∞–≥–æ–ª–æ–≤–æ–∫
    print("                 (–≠—Ç–∞–ø 3: DFS —Å —Ä–µ–∫—É—Ä—Å–∏–µ–π)")  # –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
    print("=" * 60)

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
    print("\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:")  # –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∫ –≤—ã–±–æ—Ä—É
    print("  1. –£–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤—Ä—É—á–Ω—É—é")  # –≤–∞—Ä–∏–∞–Ω—Ç 1
    print("  2. –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö")  # –≤–∞—Ä–∏–∞–Ω—Ç 2
    print("  3. –í—ã—Ö–æ–¥")  # –≤–∞—Ä–∏–∞–Ω—Ç 3

    while True:  # –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
        choice = input("\n–í–∞—à –≤—ã–±–æ—Ä (1-3): ").strip()  # –≤–≤–æ–¥ –≤—ã–±–æ—Ä–∞

        if choice == '1':  # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º 1
            interactive_mode()  # –∑–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
        elif choice == '2':  # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º 2
            file_selection_mode()  # –∑–∞–ø—É—Å–∫ —Ä–µ–∂–∏–º–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            break  # –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞
        elif choice == '3':  # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º 3
            print("–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")  # –ø—Ä–æ—â–∞–Ω–∏–µ
            return  # –≤—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã
        else:  # –µ—Å–ª–∏ –≤—ã–±–æ—Ä –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
            print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä! –í–≤–µ–¥–∏—Ç–µ 1, 2 –∏–ª–∏ 3.")  # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ


if __name__ == "__main__":
    main()  # –∑–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏